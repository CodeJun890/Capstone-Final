<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="/cvsu-icon.webp" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@500&display=swap"
      rel="stylesheet"
    />
    <title>Recover Password</title>
    <script>
      var status = '<%- JSON.stringify(status) %>';
        if (JSON.parse(status) == "verified") {
          if (confirm("Do you want to login?"))
            window.location.href = "http://localhost:5173/login";
        }
    </script>
    <style>
        .hide {
            display: none;
        }
    </style>
  </head>
  <body>
    <div class="wrapper d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="container rounded bg-light shadow-lg px-4 py-4 mx-3" style="width: 400px;">
            <form action="" method="post" id="form_recover">
                <div class="logo mx-auto mb-2" style="width: 80px;">
                    <img src="/cvsu-icon.webp" alt="cvsu logo" class="img-fluid">
                </div>
                <h5 class="text-center text-uppercase mb-3">Password Recovery</h1>
                <div class="row">
                    <p class="hide alert alert-danger text-center" id="validator">Password does not match</p>
                    <div class="input-group mb-2 flex-column">
                        <div>
                            <label for="inputPassword" class="form-label fw-bold">New Password</label>
                            <div class="input-group">
                                <input type="password" name="password" class="form-control" id="newPass" placeholder="Enter new password"><div class="input-group-text" style="cursor: pointer;"><img style="width: 20px;" src="/eye-close.png" class="hide-icon-pass" alt="eye-close"></div>
                            </div>
                        </div>
                        
                    </div>
                    <div class="input-group mb-2 flex-column">
                        <div>
                            <label for="inputPassword" class="form-label fw-bold">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmNewPass" placeholder="Confirm new password"><div class="input-group-text confirm-text" style="cursor: pointer;"><img style="width: 20px;" src="/eye-close.png" class="hide-icon-confirm" alt="eye-close"></div>
                            </div>
                        </div>
                    </div>
                    <div><button class="btn btn-success mt-3 w-100">Submit</button></div>
                </div>
            </form>
        </div>
    </div>
  </body>

  <script>

      document.addEventListener("DOMContentLoaded", () => {
          const form = document.getElementById("form_recover");
          const validator = document.getElementById("validator");

          form.addEventListener("submit", (e) => {
              e.preventDefault();

              const newPass = document.getElementById("newPass").value;
              const confirmNewPass = document.getElementById("confirmNewPass").value;
      
              if(newPass !== confirmNewPass){
                  validator.classList.remove("hide");
              }else{
                  validator.classList.add("hide");
                  form.submit();
              }
          })

          const hideTextPass = document.querySelector(".input-group-text");
          const hideTextConfirm = document.querySelector(".confirm-text");
          const base_url = window.location.origin;
          
          hideTextPass.addEventListener("click", () => {
              const newPass = document.getElementById("newPass");
              const icon_pass = document.querySelector(".hide-icon-pass");
              let iconSplit_pass = icon_pass.src.split(base_url)[1];
              if(iconSplit_pass === "/eye-close.png"){
                  icon_pass.src = "/eye-open.png";
                  newPass.type = "text";
              }else{
                  icon_pass.src = "/eye-close.png";
                  newPass.type = "password";
              }
          });

          hideTextConfirm.addEventListener("click", () => {
              const confirmNewPass = document.getElementById("confirmNewPass");
              const icon_confirm = document.querySelector(".hide-icon-confirm");
              let iconSplit_confirm = icon_confirm.src.split(base_url)[1];
              if(iconSplit_confirm === "/eye-close.png"){
                  icon_confirm.src = "/eye-open.png";
                  confirmNewPass.type = "text";
              }else{
                  icon_confirm.src = "/eye-close.png";
                  confirmNewPass.type = "password";
              }
          });


      })
  </script>
</html>
